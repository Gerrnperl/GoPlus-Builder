# 功能模块划分

![image-20240725160522955](./assets/image-20240725160522955.png)

[产品需求文档](https://ncuhomer.feishu.cn/docx/Ghg0dqLmRoPVrlxHmXzcbjgDnEf?from=from_copylink)

## fiama原型图

https://www.figma.com/design/Q32DIEm4tpDsrk7sPZvRKX/go%2Bbuilder?node-id=0-1&t=5deNPJ3ceqI8wO3f-0

# 风险分析

核心需求中，搜索与分类等皆为常规功能，AI生成部分整体风险较高，非常规功能+低延迟（搜索要求等），需要重点关注。

### **整体风险来源**：

AI生成部分的不确定性

### **AI生成部分风险来源：**

1.  **生成内容的质量**：AI生成的资产的质量和相关性必须符合用户期望。质量低劣或不相关的内容可能导致用户不满意。
2. **延迟**：开发和集成AI生成功能需要保证ai生成较低的延迟。此处的任何问题都可能影响用户体验。
3. **动画相关部分技术的不确定性**：动画相关部分的渲染和生成

### 风险预防：

1. 及时与相关ai开发人员沟通
2. 及早调研动画渲染相关技术，明确后续思路
3. 安排好相关人员排期，留足突发情况处理时间
4. 对ai生成质量进行把控（？）

# 分层架构

![image-20240725160659326](./assets/image-20240725160659326.png)

# 模块详细设计

## 后端部分

### **图片生成模块后端实现**

 **概述**

- 模块名称：图片生成模块
- 模块描述：实现ai生成素材，补充搜索结果的需求。
- 目标：提供高效、符合预期的素材生成服务。

 **功能需求**

- 生成与用户输入一致（keyword、category）的素材。
- 提供查询生成状态接口，以便前端获取查询状态

**实现方案**

- 解析前端传递的参数，主要是category和keyword。
- 将参数传递给aigc服务器。
- 将生成摘要返回给前端。
- 将生成状态返回给前端。

![image-20240725160715631](./assets/image-20240725160715631.png)

### **查询模块后端实现**

 **概述**

- 模块名称：查询模块
- 模块描述：实现用户在素材库中精准查询的需求。
- 目标：提供高效、准确的查询服务。

 **功能需求**

- 用户可以通过关键词搜索商品。
- 用户可以按类别、价格范围、品牌等筛选素材。
- 搜索结果需要以关联度来进行排序，关联度高的放在前面
- 用户可以对查询结果进行排序（如按价格、评分、时间等）。
- 支持分页显示查询结果。
- 显示每个商品的详细信息，包括名称、图片等。

**实现方案**

- 解析前端传递的参数，主要是category和keyword。
- 经过encoding将参数转化为词向量。
- 将词向量放入向量数据库（暂定milvus）比对，将结果按匹配度排序。
- 将搜索到的结果（暂定结果为asset_id）放入mysql中查找。
- 返回查询结果。

![image-20240725160728662](./assets/image-20240725160728662.png)

### **添加ai素材模块后端实现**

 **概述**

- 模块名称：添加ai素材模块
- 模块描述：用户点击收藏或添加某一ai生成的素材后，可以将该素材添加至公有素材库中。
- 目标：添加ai素材到公有素材库。

 **功能需求**

- 添加ai素材到公有素材库。

**实现方案**

- 解析前端传递的参数，ai素材的url和id。
- 查询此素材对应的词向量。
- 后端将此素材信息（id、词向量）写入milvus和数据库。

![image-20240725160742480](./assets/image-20240725160742480.png)


## 时序图

### 搜索、AI素材预生成

![image-20240725161126697](./assets/image-20240725161126697.png)

### 搜索结果、详情页、收藏、添加到项目

![image-20240725161138034](./assets/image-20240725161138034.png)

### AI生成结果、AI素材生成（背景扣除、骨骼绑定等）

![image-20240725161150019](./assets/image-20240725161150019.png)

## 接口

## API文档

[后端服务API](https://fxj4kdez1kc.feishu.cn/wiki/Dqh4wBrXlisVenkM4SCcU62Hnvd)

https://app.apifox.com/invite/project?token=069BkUW4OItXzhb3mHho4

https://app.apifox.com/project/4854588

https://apifox.com/apidoc/shared-cef04b18-6c83-4c6a-9466-1ac66acfdff3/api-195901658
